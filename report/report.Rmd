---
title: '<header style="text-align: center">
			<h1 style="font-weight: bold; font-size: 44px" class="toc-ignore">2016 Brussels Bombings</h1>
			<h2 class="toc-ignore">Air Traffic Analysis</h2>
		</header>'
author: '<div style="text-align: center">
			<span style="display: inline-block; width: 30%; margin: 0 5px">[Ramiro Balado Ordax](https://github.com/Qjammer)</span>
			<span style="display: inline-block; width: 30%; margin: 0 5px">[Alejandro Hernández Rubio](https://github.com/Shyryuu)</span>
			<span style="display: inline-block; width: 30%; margin: 0 5px">[Pol Mesalles Ripoll](https://github.com/polmes)</span>
		</div>'
# date: "DD/MM/YYYY"
output:
    rmarkdown::html_document:
        theme: cosmo
        highlight: tango
        number_sections: true
        toc: true
        toc_float: true
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Air Traffic

## Air Traffic Evolution {.tabset .tabset-fade}

```{r, fig.align='center'}
ddr.times(data$real$flights, bru, event)
```

- Find average before/after (get % difference)

Bizarrely, despite the airport supposedly being closed from March 22 to April 3, the number of flights during the days following the attack is non-zero. Let's take a closer look at these flights:

### EBBR Departures {-}

```{r}
datatable(ufo[orig == bru, .(dest, airline, aircraft, takeoff, landing)], options = list(dom = 'tp', columnDefs = list(list(className = 'dt-center', targets = '_all'))), colnames = c('Destination', 'Airline', 'Aircraft', 'Departure', 'Arrival')) %>%
	formatDate(columns = c('takeoff', 'landing'), method = 'toLocaleString')
```

### EBBR Arrivals {-}

```{r}
datatable(ufo[dest == bru, .(orig, airline, aircraft, takeoff, landing)], options = list(dom = 'tp', columnDefs = list(list(className = 'dt-center', targets = '_all'))), colnames = c('Origin', 'Airline', 'Aircraft', 'Departure', 'Arrival')) %>%
	formatDate(columns = c('takeoff', 'landing'), method = 'toLocaleString')
```

## Diverted Flights {.tabset .tabset-fade}

On the day of the event, March 22, 2016, there were a total of `r div[, .N]` diverted flights that had intended to land on Brussels Airport (EBBR).

```{r, fig.align='center'}
datatable(div[, .(orig, dest, airline, diff, fuel)], options = list(dom = 'tp', columnDefs = list(list(className = 'dt-center', targets = '_all'))), colnames = c('Origin', 'Destination', 'Airline', 'Distance Delta (NM)', 'Fuel Delta (kg)')) %>%
	formatRound(columns = c('diff', 'fuel'), digits = 2)
```

On average, airlines actually saved `r format(abs(div[, mean(fuel)]), digits = 3)` kg of fuel by diverting flights to airports closer to the origin point.

### Static Map {-}

```{r, fig.align='center'}
ddr.map(data$real$routes[id %in% div[, id]], autocenter = FALSE)
```

### Interactive Map {-}

```{r, fig.align='center'}
ddr.jsmap(data$real$routes[id %in% div[, id]], div, coord)
```

### Animation {-}

```{r, message=FALSE, results=FALSE}
gifname <- 'diverted'
giffile <- file.path('..', 'data', paste0(gifname, '.gif'))
if (!file.exists(giffile)) {
	ddr.animate(data$real$routes[id %in% div[, id]], giffile)
}
```
![Diverted Flights Map Animation](`r giffile`) \


# Airports

The nearby airports to EBBR include:

- EBCI (Brussels South Charleroi)
- EBLF (Liège)
- EHEH (Eindhoven)
- EBAW (Antwerp)
- LFQQ (Lille)

## Traffic in nearby airports

```{r, fig.align='center', fig.height=2.5}
ddr.times(data$real$flights, 'EBCI', event, group = 'nearby')
# ddr.times(data$real$flights, 'EBLF', event, group = 'nearby')
ddr.times(data$real$flights, 'EHEH', event, group = 'nearby')
ddr.times(data$real$flights, 'EBAW', event, group = 'nearby')
ddr.times(data$real$flights, 'LFQQ', event, group = 'nearby')
```

- Find average before/after (get % difference)

## Delays in nearby airports

- Delays on each airport vs. time (per hour)
- Boxplot (mean + sigma) comparing average delays on each airport (while EBBR closed)
- Find average delay before/during/after

# Airlines

- Find from total flights the airlines that were most affected (from those that travel to EBBR)
- Average delays (while EBBR closed) by airline
